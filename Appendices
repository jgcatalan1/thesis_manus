APPENDICES
Appendix 1. Informed Consent Form for Rice Farmers Participating in the GabayPalay Project
Principal Investigator: 	Joey Laurence G. Catalan
Organization: 	University of the Philippines Mindanao
Sponsor: 	Hagonoy Farmers Multi-Purpose Cooperative (HAFAMUPCO)
Project Title and Version: 	GabayPalay: A Mobile Application for Predicting Palay Yield to Support Farmer Decision-Making 

PART I: INFORMATION SHEET

Introduction
You are invited to participate in a research study led by Joey Laurence G. Catalan from the University of the Philippines Mindanao. This study aims to develop and evaluate a mobile application, GabayPalay, designed to help rice farmers predict potential palay yield based on their farming inputs and practices. Please take your time to decide if you want to participate. If anything is unclear, we will explain all terms and you may ask questions at any time.

Purpose of the Research
This research seeks to understand local farming practices and challenges and to create a mobile app that provides rice yield predictions. The goal is to help farmers like you make better decisions about farm inputs and improve productivity. The study also wants to know how easy and useful you find the app.

Type of Research Intervention
This study uses an exploratory sequential mixed-methods design. It will begin with interviews to explore farmers’ experiences and practices. The insights from these interviews will then help develop a survey, which will be distributed to more farmers. The combined results will be used to improve the GabayPalay mobile application and understand its usefulness to rice farmers.

Participant Selection
You have been invited because you are a rice farmer in Hagonoy, Davao del Sur. We want to include farmers ages 18-59 years old, with different farm sizes and experiences to get a good understanding of local practices.

Appendix 1. (cont.)
Voluntary Participation
Your participation is voluntary. You may choose to join or not. If you decide not to participate, you will not lose any benefits or services that you usually receive. You may withdraw at any time, and you may request that your information not be used.
 
Procedures
You will be involved in the research study through a short interview and/or answering a survey. During this process, you will be asked questions about your farming practices, use of farm inputs, rice yield, and your experience with mobile technology in agriculture. Some questions may be personal or sensitive, but you are free to skip any question you do not wish to answer.

The interview and survey will be conducted at a location convenient for you, with only the researcher present unless you prefer someone else to accompany you. You may answer the questions directly or have the researcher read them aloud and record your responses. All information you provide will be kept confidential; your name will not appear on any forms, and a code number will be used instead. Only authorized researchers will have access to your responses. All records will be securely stored and destroyed after a set period.

Duration
Participation will take approximately 10-30 minutes per session (interview or survey). If you evaluate the app, this may take an additional 30 minutes.

Risks
There are no major risks anticipated from your participation in this study. Some questions may be personal or sensitive, such as those about your farming practices, or technology use. You do not have to answer any question that makes you uncomfortable or that you feel is too private. If at any point you feel uneasy or wish to skip a question, please inform the researcher, and you may move on to the next part of the interview or survey.

Benefits
You may benefit by learning about new agricultural technologies and practices. The community may benefit from better access to yield prediction tools and farming advice. Society may benefit from improved rice productivity and sustainability.

Reimbursements
You will not be paid for participating, but reasonable expenses (such as transport) will be reimbursed.

Appendix 1. (cont)
Confidentiality
The research team will take all reasonable steps to maintain the confidentiality of both your identity and the information you share. Your responses will be securely stored, and only authorized members of the research team will have access to them. Your name will not appear in any reports or publications; instead, a code number will be used to identify your data.

If you share information that is particularly sensitive or personal, we will take extra precautions to protect your safety and anonymity. This includes securely storing recordings and notes, destroying records after the study is completed, and ensuring that no personally identifying details are included in any public results. If at any time you feel uncomfortable, you may withdraw from the study or ask that certain information not be included.

Sharing the Results
The results of this study are intended primarily for use by the research team for the development and evaluation of the GabayPalay mobile application. There is a possibility that summarized findings may be shared with relevant stakeholders, such as agricultural organizations or local leaders, but no personal information or identifiers will be included. If any results are shared outside the research team, they will be presented in a way that does not identify you or any individual participant.

Right to Refuse or Withdraw
You may refuse to participate or withdraw at any time, with no penalty. You may review and erase your contributions from interviews or discussions if you wish.

Who to Contact
For questions or concerns, contact:

JOEY LAURENCE G. CATALAN,	
Principal Investigator/Researcher
Email: jgcatalan1@up.edu.ph
Phone: (+63) 909 081 5170

ASST. PROF. JOHN HENLY O. SANTILLAN, MIS
Faculty Adviser
Email: josantillan@up.edu.ph

Appendix 1. (cont)
Local Research Ethics Committee: 
PROF. ALEYLA E. DE CADIZ, Ph. D.
Address: Office of Research, Administration Building, 
Mintal, Tugbok District, Davao City 8022 Philippines
Email: rec.upmindanao@up.edu.ph 
Tel: 082-293-1839
Phone: +63 956 073 9035
 
PART II: CERTIFICATE OF CONSENT

I have read (or had read to me) the information above. My questions have been answered. 

I freely consent to participate in this study.
Print Name of Participant: __________________________
Signature of Participant: __________________________
Date (MM/DD/YYYY): __________________________

If Illiterate:
A literate witness must sign (selected by the participant and not connected to the research team). The participant provides a thumb print.
I have witnessed the accurate reading of the consent form to the participant, who had the opportunity to ask questions. The participant consented freely.

Print Name of Witness: __________________________
Thumb Print of Participant: __________________________
Signature of Witness: __________________________
Date (MM/DD/YYYY): __________________________

Statement by the Researcher or Person Taking Consent
I have accurately read the information sheet to the participant and explained the following:
1.	The nature and procedures of the study, including interviews, surveys, and app use.
2.	That participation is voluntary and may be withdrawn at any time.
3.	How confidentiality will be maintained.
The participant’s questions have been answered, and consent was given freely and voluntarily. A copy of this form has been provided to the participant.

Print Name of Researcher: __________________________
Signature of Researcher: __________________________
Date (MM/DD/YYYY): __________________________ 
Appendix 2. Interview Guide for Hagonoy Farmers
Introduction for Participant:
Thank you for agreeing to participate in this interview about rice farming practices and technology. Your answers will help us improve tools for farmers like you. Your participation is voluntary, and you may skip any question or stop the interview at any time. Everything you share will be kept confidential and used only for research purposes.

(Bisaya Translation)
Salamat sa imong pag-uyon nga moapil sa kini nga interview bahin sa praktis sa pagpanguma og humay ug teknolohiya. Ang imong tubag makatabang sa pagpaayo sa mga gamit para sa mga mag-uuma. Boluntaryo ang imong pag-apil, ug pwede nimo dili tubagon ang bisan unsang pangutana o undangon ang interview bisan kanus-a. Ang tanan nimong tubag among taguon ug gamiton lang para sa research.


In current farming practices:
1.	What methods do you use for managing land preparation, seeding, fertilization, and pest control? 
(Bisaya Translation: Unsa nga mga pamaagi ang imong gigamit sa pagdumala sa pag-andam sa yuta, pagsabod, pag-abono, ug pagpugong sa peste?)
2.	How do you determine the quantities of seeds, fertilizers, and pesticides? 
(Bisaya Translation: Unsaon nimo pagkabalo sa mga kantidad sa mga binhi, abono, ug pesticides?)
3.	What challenges do you face during the farming cycle? 
(Bisaya Translation: Unsa nga mga hagit ang imong giatubang sa panahon sa siklo sa pagpanguma?)

In mobile application usage:
1.	Are you aware of any mobile applications designed for farmers? If yes, which ones?
(Bisaya Translation: Nahibalo ka ba sa bisan unsang mobile application nga gihimo alang sa mga mag-uuma? Kung oo, hain niini?)
2.	Have you used mobile applications for farming? Why or why not? 
(Bisaya Translation: Nakagamit na ba ka og mga mobile application para sa pagpanguma? Ngano o ngano nga dili?)
3.	What features would you find useful in a farming app?
(Bisaya Translation: Unsa nga mga bahin ang imong makita nga mapuslanon sa usa ka app sa panguma?)

Appendix 2. (cont.)
In improvement factors:
4.	What information or tools could enhance your rice productivity?
(Bisaya Translation: Unsa nga impormasyon o mga gamit ang makapauswag sa imong pagka-produktibo?) 
5.	How do you measure the success of a farming season?
(Bisaya Translation: Giunsa nimo pagsukod ang kalampusan sa usa ka season sa pagpanguma?)


Closing Statement:
Thank you for sharing your experiences and insights. If you have any questions or concerns about this study, you may contact me at 09090815170 or jgcatalan1@up.edu.ph.

Bisaya Translation
Salamat sa pagbahin sa imong kasinatian ug mga ideya. Kung naa kay pangutana o kabalaka bahin sa research, pwede ko nimo kontakon sa 09090815170 o jgcatalan1@up.edu.ph.

 
Appendix 3. Survey Instrument Form
Survey on Palay Yield and Agronomic Factors

I am Joey Laurence G. Catalan from UP Mindanao, conducting research on rice yield and farming practices in Hagonoy, Davao del Sur. This study will help develop better tools and strategies for rice farmers. Your participation is voluntary, and all answers will be kept confidential and used only for research. If you have questions, you may contact me at 09090815170 or jgcatalan1@up.edu.ph.

☐ I have read and understood the information above and agree to participate.

Date: ________________________


Instruction: Please answer the following questions truthfully. Place a check (✓) on the box that corresponds to your answer and fill in the blanks where applicable. All information will be kept strictly confidential and used only for academic and research purposes.

I.	Farmer and Farm Profile
1.	Sex: ☐ Male ☐ Female ☐ Other
2.	I have been farming for: _______ years
3.	My farm is located in (Barangay, Municipality): ___________________
4.	My total farm area is: __________ hectares

II.	Seed and Planting Practices
1.	The rice variety I plant is:
☐ Traditional ☐ Hybrid ☐ Other: ___________
2.	My planting method is: 
☐ Direct Seeding ☐ Transplanting
3.	The seed rate I use is: ___________ kg

III.	Land Preparation and Fertilizer Application
1.	For land preparation, I use: 
☐ Manual (animal-assisted) 
☐ Tractor 
☐ Rotavator
2.	Application Timing (e.g., Days After Transplanting):
i.	First Application:
a.	Fertilizer Name: ________________ Amount used: ________ kg
b.	Fertilizer Name: ________________ Amount used: ________ kg
c.	Fertilizer Name: ________________ Amount used: ________ kg
d.	Fertilizer Name: ________________ Amount used: ________ kg
Appendix 3. (cont.)
ii.	Second Application:
a.	Fertilizer Name: ________________ Amount used: ________ kg
b.	Fertilizer Name: ________________ Amount used: ________ kg
c.	Fertilizer Name: ________________ Amount used: ________ kg
iii.	Third Application:
a.	Fertilizer Name: ________________ Amount used: ________ kg
b.	Fertilizer Name: ________________ Amount used: ________ kg
c.	Fertilizer Name: ________________ Amount used: ________ kg

IV.	Pest and Weed Management
1.	The common pests and diseases I encounter are (check all that apply):
☐ Stem Borer ☐ Rodents ☐ Kuhol (Golden Apple Snail) ☐ Rice Blast ☐ Other: ___________
2.	The types of pesticides I use are (check all that apply):
☐ Insecticide | Amount used: _________ L AI/ha
☐ Herbicide | Amount used: _________ L AI/ha
☐ Fungicide | Amount used: _________ L AI/ha
☐ Other: ________ | Amount used: ____ L AI/ha

V.	Environmental and Yield Data
1.	My farm’s water source for irrigation is:
☐ NIA Irrigation ☐ Rainfed ☐ Deep Well 
☐ Other: ___________
2.	The weather-related challenges I have experienced in the last season include (check all that apply):
☐ Drought ☐ Flooding ☐ Typhoon 
☐ Temperature Extremes
☐ Other: ________________
3.	My estimated rice yield per hectare is: ___________ kg/ha or sacks

 
Appendix 4. Python Script for Data Pre-processing and Feature Engineering of Rice Yield Dataset
import pandas as pd  # Import pandas for data manipulation

# Load raw data from Excel file, specifically the "Pre-processed" sheet
df = pd.read_excel("Quantitative Data.xlsx", sheet_name="Pre-processed")

# Define NPK (Nitrogen, Phosphorus, Potassium) compositions for each fertilizer
fertilizer_npk = {
    'Urea (46-0-0)': (46, 0, 0),
    'Ammonium Sulfate (21-0-0)': (21, 0, 0),
    'Ammonium Phosphate (16-20-0)': (16, 20, 0),
    'Complete (14-14-14)': (14, 14, 14),
    'Potash (0-0-60)': (0, 0, 60)
}

# Compute total NPK per phase (First, Second, Third)
for phase in ['First', 'Second', 'Third']:
    tn, tp, tk = [], [], []  # Lists to store total N, P, K for each row
    for idx, row in df.iterrows():  # Iterate through each row in the DataFrame
        n = p = k = 0  # Initialize N, P, K totals for this row
        
        # Sum NPK from all mapped fertilizers for this phase
        for fert, (n_pct, p_pct, k_pct) in fertilizer_npk.items():
            # Column name for this fertilizer and phase
            col = f'Fertilizer - {phase} Application - {fert}'
            if col in df.columns:
                amt = row[col]
                if pd.notnull(amt) and amt > 0: 
                    n += amt * (n_pct / 100)  # Add N contribution
                    p += amt * (p_pct / 100)  # Add P contribution
                    k += amt * (k_pct / 100)  # Add K contribution
                    
        # Store total NPK for this row            
        tn.append(n)
        tp.append(p)
        tk.append(k)
        
    # Add total NPK columns for this phase to the DataFrame
    df[f'Total_N_{phase}'] = tn
    df[f'Total_P_{phase}'] = tp
    df[f'Total_K_{phase}'] = tk

# Drop original fertilizer columns to keep only the computed totals
df.drop(columns=[col for col in df.columns if "Fertilizer - " in col], inplace=True)

# Rename columns to Xi variables (features) and Y (target)
rename_dict = {
    # Pre-planting and planting method features
    'Land Area (in ha)': 'X1',
    'Rice Variety (1 - Hybrid, 0 - Inbred)': 'X2',
    'Amount of Seed used (in kg)': 'X3',
    'Planting Method (1 - Transplanted, 0 - Direct Seeding)': 'X4',
    'Land preparation - Manual': 'X5',
    'Land Preparation - Tractor': 'X6',
    'Land Preparation - Rotavator': 'X7',
    'NIA Irrigation?': 'X8',
    
    # Total NPK features
    'Total_N_First': 'X9',  'Total_P_First': 'X10',  'Total_K_First': 'X11',
Appendix 4. (cont.)    
'Total_N_Second': 'X12','Total_P_Second': 'X13','Total_K_Second': 'X14',
    'Total_N_Third': 'X15', 'Total_P_Third': 'X16','Total_K_Third': 'X17',
    
    # Pest management features
    'Pest Management - Has a pest - Stem Borer': 'X18',
    'Pest Management - Has a pest - Rats': 'X19',
    'Pest Management - Has a pest - Kuhol': 'X20',
    'Pest Management - Has a pest - Cutworms': 'X21',
    'Pest Management - Has a pest - Rice Blast': 'X22',
    'Pest Management - Types of pesticides - Insecticide (in L)': 'X23',
    'Pest Management - Types of pesticides - Herbicide (in L)': 'X24',
    'Pest Management - Types of pesticides - Rat Poison (in grams)': 'X25',
    'Pest Management - Types of pesticides - Molluscicide (in sachets)': 'X26',
    
    # Weather-related challenges
    'Weather related challenges': 'X27',
    
    # Target variable
    'Palay Yield (in kg)': 'Y'
}
df.rename(columns=rename_dict, inplace=True)  # Apply renaming

# Export selected columns (X1 to X27 and Y) to CSV file
df[[f'X{i}' for i in range(1, 28)] + ['Y']].to_csv("processed_data.csv", index=False)
print('Processed data saved as "processed_data.csv"')
 
Appendix 5. Python Script for Random Forest Model Development, Evaluation, and Android Integration for Palay Yield Prediction
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import os
import json
import joblib
import m2cgen as m2c

from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import train_test_split, GridSearchCV, learning_curve, KFold
from sklearn.metrics import mean_squared_error, mean_absolute_error, r2_score
from sklearn.inspection import PartialDependenceDisplay

# -----------------------------
# Step 1: Load processed Data
# -----------------------------
df = pd.read_csv("processed_data.csv")
feature_names = [f"X{i}" for i in range(1, 28)]
X = df[feature_names]          # DataFrame preserves column names
y = df["Y"]

# -----------------------------
# Step 2: Train-Test Split
# -----------------------------
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.30, random_state=42, shuffle=True
)

# -----------------------------
# Step 3: Grid Search with 3-Fold Cross-Validation
# -----------------------------
param_grid = {
    'n_estimators': [100, 200, 300, 400],
    'max_depth': [None, 10, 20],
    'min_samples_split': [2, 4, 6],
    'min_samples_leaf': [1, 2, 3],
    'max_features': ['sqrt', 'log2']
}

rf = RandomForestRegressor(random_state=42)
grid_search = GridSearchCV(
    estimator=rf,
    param_grid=param_grid,
    cv=3,              # keep consistent with Methods
    scoring='r2',
    n_jobs=-1,
    verbose=1
)
grid_search.fit(X_train, y_train)

# -----------------------------
# Step 4: Create Output Directory and Evaluate All Parameter Sets on Test Set
# -----------------------------
output_dir = "model_outputs"
plots_dir = os.path.join(output_dir, "plots")
os.makedirs(plots_dir, exist_ok=True)

cv_results = pd.DataFrame(grid_search.cv_results_)
metrics = {
    "Test_MSE": [],
    "Test_RMSE": [],
    "Test_MAE": [],
    "Test_R2": []
}

for i in range(len(cv_results)):
    params = cv_results.loc[i, "params"]
    model = RandomForestRegressor(**params, random_state=42)
    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)
    mse = mean_squared_error(y_test, y_pred)
    rmse = np.sqrt(mse)
    mae = mean_absolute_error(y_test, y_pred)
    r2 = r2_score(y_test, y_pred)

    metrics["Test_MSE"].append(mse)
    metrics["Test_RMSE"].append(rmse)
    metrics["Test_MAE"].append(mae)
    metrics["Test_R2"].append(r2)

cv_results["Test_MSE"] = metrics["Test_MSE"]
cv_results["Test_RMSE"] = metrics["Test_RMSE"]
cv_results["Test_MAE"] = metrics["Test_MAE"]
cv_results["Test_R2"] = metrics["Test_R2"]

os.makedirs(output_dir, exist_ok=True)
cv_results.to_excel(os.path.join(output_dir, "grid_search_evaluation.xlsx"), index=False)
# Also save to CSV for direct citation in the manuscript
cv_results.to_csv(os.path.join(output_dir, "grid_search_evaluation.csv"), index=False)

# -----------------------------
# Step 5: Save Best Model and Params
# -----------------------------
best_model = grid_search.best_estimator_
best_params = grid_search.best_params_
best_index = grid_search.best_index_
joblib.dump(best_model, os.path.join(output_dir, "palay_yield_model.pkl"))

with open(os.path.join(output_dir, "best_params.json"), "w") as f:
    json.dump(best_params, f, indent=2)

# -----------------------------
# Step 6: Evaluate Best Model on Test Set (explicit, for thesis figures)
# -----------------------------
y_pred_test = best_model.predict(X_test)
test_mse = mean_squared_error(y_test, y_pred_test)
test_rmse = np.sqrt(test_mse)
test_mae = mean_absolute_error(y_test, y_pred_test)
test_r2 = r2_score(y_test, y_pred_test)

test_metrics_df = pd.DataFrame({
    "Metric": ["MSE", "RMSE", "MAE", "R²"],
    "Value": [test_mse, test_rmse, test_mae, test_r2]
})
test_metrics_df.to_excel(os.path.join(output_dir, "best_model_test_metrics.xlsx"), index=False)
test_metrics_df.to_csv(os.path.join(output_dir, "best_model_test_metrics.csv"), index=False)

# Save paired predictions for plotting/review
pd.DataFrame({"actual_y": y_test.to_numpy(), "pred_y": y_pred_test}).to_csv(
    os.path.join(output_dir, "test_predictions.csv"), index=False
)

# -----------------------------
# Step 7: Evaluate Best Model on Entire Dataset (apparent performance)
# -----------------------------
y_pred_all = best_model.predict(X)
mse_all = mean_squared_error(y, y_pred_all)
rmse_all = np.sqrt(mse_all)
mae_all = mean_absolute_error(y, y_pred_all)
r2_all = r2_score(y, y_pred_all)

print("Evaluation Metrics (on Entire Dataset):")
print(f"MSE:  {mse_all:.2f}")
print(f"RMSE: {rmse_all:.2f}")
print(f"MAE:  {mae_all:.2f}")
print(f"R²:   {r2_all:.4f}")

metrics_df = pd.DataFrame({"Metric": ["MSE", "RMSE", "MAE", "R²"],
                           "Value": [mse_all, rmse_all, mae_all, r2_all]})
metrics_df.to_excel(os.path.join(output_dir, "best_model_full_sample_metrics.xlsx"), index=False)
metrics_df.to_csv(os.path.join(output_dir, "best_model_full_sample_metrics.csv"), index=False)

# -----------------------------
# Step 8: Visualizations
# -----------------------------
# 8a. Test-set plots for the manuscript
plt.figure()
plt.scatter(y_test, y_pred_test, alpha=0.75)
lims = [min(y_test.min(), y_pred_test.min()), max(y_test.max(), y_pred_test.max())]
plt.plot(lims, lims, 'r--', label='1:1 line')
plt.xlabel("Actual Yield (kg)")
plt.ylabel("Predicted Yield (kg)")
plt.title(f"Actual vs Predicted (Test Set)\nR²={test_r2:.3f}, RMSE={test_rmse:.0f} kg, MAE={test_mae:.0f} kg")
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig(os.path.join(plots_dir, "predicted_vs_actual_test.png"))
plt.close()

residuals_test = y_test.to_numpy() - y_pred_test
plt.figure()
plt.scatter(y_pred_test, residuals_test, alpha=0.75)
plt.axhline(0, color='red', linestyle='--')
plt.xlabel("Predicted Yield (kg)")
plt.ylabel("Residuals (kg)")
plt.title("Residual Plot (Test Set)")
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig(os.path.join(plots_dir, "residuals_test.png"))
plt.close()

# 8b. All-sample plots (keep for appendix)
residuals_all = y - y_pred_all
importances = best_model.feature_importances_
indices = np.argsort(importances)[::-1]

plt.figure()
plt.scatter(y, y_pred_all, alpha=0.7)
plt.plot([y.min(), y.max()], [y.min(), y.max()], 'r--')
plt.xlabel("Actual Yield (kg)")
plt.ylabel("Predicted Yield (kg)")
plt.title("Actual vs Predicted (All Samples)")
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig(os.path.join(plots_dir, "predicted_vs_actual_all.png"))
plt.close()

plt.figure(figsize=(12, 6))
plt.bar(range(X.shape[1]), importances[indices])
plt.xticks(range(X.shape[1]), [feature_names[i] for i in indices], rotation=90)
plt.title("Feature Importances (impurity-based)")
plt.tight_layout()
plt.savefig(os.path.join(plots_dir, "feature_importance.png"))
plt.close()

plt.figure()
plt.scatter(y_pred_all, residuals_all, alpha=0.7)
plt.axhline(0, color='red', linestyle='--')
plt.xlabel("Predicted Yield (kg)")
plt.ylabel("Residuals (kg)")
plt.title("Residual Plot (All Samples)")
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig(os.path.join(plots_dir, "residuals_all.png"))
plt.close()

# 8c. Learning Curve (make folds consistent with CV=3 unless intentional)
train_sizes, train_scores, test_scores = learning_curve(
    best_model, X, y, cv=3, scoring='r2',
    train_sizes=np.linspace(0.1, 1.0, 5), n_jobs=-1
)
train_mean = np.mean(train_scores, axis=1)
test_mean = np.mean(test_scores, axis=1)

plt.figure()
plt.plot(train_sizes, train_mean, label="Training R²", marker='o')
plt.plot(train_sizes, test_mean, label="Validation R²", marker='o')
plt.xlabel("Training Set Size")
plt.ylabel("R² Score")
plt.title("Learning Curve")
plt.grid(True, alpha=0.3)
plt.legend()
plt.tight_layout()
plt.savefig(os.path.join(plots_dir, "learning_curve.png"))
plt.close()

# 8d. Partial Dependence Plot (Top 3 Features, labeled)
top3_idx = indices[:3].tolist()
top3_names = [feature_names[i] for i in top3_idx]
fig, ax = plt.subplots(figsize=(10, 6))
PartialDependenceDisplay.from_estimator(best_model, X, features=top3_names, ax=ax)
plt.tight_layout()
plt.savefig(os.path.join(plots_dir, "partial_dependence.png"))
plt.close()

# -----------------------------
# Step 9: Export to Java (for Android Integration)
# -----------------------------
java_code = m2c.export_to_java(best_model)
# Save as .java (Kotlin can call Java classes directly)
with open(os.path.join(output_dir, "PalayYieldModel.java"), "w", encoding="utf-8") as f:
    f.write(java_code)

# -----------------------------
# Step 9.1: Export Feature Importance for Android
# -----------------------------
def generate_feature_importance_java(feature_names, importance_values):
    """Generate Java methods for feature importance and names."""
    java_method = """
    /**
     * Get feature importance from the trained Random Forest model.
     * @return Array of feature importance values (summing to 1.0 approximately).
     */
    public static double[] getFeatureImportance() {
        return new double[] {
"""
    for i, (name, importance) in enumerate(zip(feature_names, importance_values)):
        java_method += f"            {importance:.6f}"  # {name}
        if i < len(importance_values) - 1:
            java_method += ","
        java_method += f"  // {name}\\n"
    java_method += """        };
    }

    /**
     * Get feature names in the same order as importance values.
     * @return Array of feature names.
     */
    public static String[] getFeatureNames() {
        return new String[] {
"""
    for i, name in enumerate(feature_names):
        java_method += f'            "{name}"'
        if i < len(feature_names) - 1:
            java_method += ","
        java_method += "\\n"
    java_method += """        };
    }"""
    return java_method

feature_importance = best_model.feature_importances_
java_importance_code = generate_feature_importance_java(feature_names, feature_importance)

with open(os.path.join(output_dir, "FeatureImportanceMethods.java"), "w", encoding="utf-8") as f:
    f.write(java_importance_code)

importance_dict = dict(zip(feature_names, feature_importance.tolist()))
with open(os.path.join(output_dir, "feature_importance.json"), "w") as f:
    json.dump(importance_dict, f, indent=2)

# -----------------------------
# Step 10: Final Summary
# -----------------------------
print("\n" + "="*50)
print("FINAL SUMMARY")
print("="*50)
print(f"Best params: {best_params}")
print(f"Best CV mean R²: {cv_results.loc[best_index, 'mean_test_score']:.4f} ± {cv_results.loc[best_index, 'std_test_score']:.4f}")
print(f"Test R²: {test_r2:.4f}, RMSE: {test_rmse:.1f} kg, MAE: {test_mae:.1f} kg")
print(f"Full-sample R²: {r2_all:.4f}, RMSE: {rmse_all:.1f} kg, MAE: {mae_all:.1f} kg")
print("\nOutputs saved to:", os.path.abspath(output_dir))
print(" - Best model: palay_yield_model.pkl")
print(" - Grid search: grid_search_evaluation.xlsx and .csv")
print(" - Best params: best_params.json")
print(" - Test metrics: best_model_test_metrics.xlsx and .csv")
print(" - Full-sample metrics: best_model_full_sample_metrics.xlsx and .csv")
print(" - Test predictions: test_predictions.csv")
print(" - Plots:", os.path.abspath(plots_dir))
print(" - Java model:", os.path.join(output_dir, "PalayYieldModel.java"))
print(" - Feature importance (Java methods, JSON)")
 
Appendix 6. GabayPalay Mobile Application User Interface Mockups
The following figures present the sequence of user interface screens designed for the GabayPalay mobile application, illustrating the step-by-step process from input collection to yield prediction. These mockups demonstrate the app’s core functionalities for rice yield estimation based on agronomic inputs.
The initial screen (A) allows users to start the yield prediction process, view history, access settings, or change the app language. On the pre-planting input screen (B), users provide information about their land area, rice variety, seed amount, planting method, and land preparation techniques. Nutrient management is addressed in two screens: (C) enables users to select the number of fertilizer applications, while (D) allows them to specify fertilizer details for each application, with real-time NPK computation.
Appendix Figure 1. Home Screen Mockup
 

(A)
Appendix 6. (cont.)
Pest management is handled on screen (E), where users indicate expected pests and enter pesticide details. Weather management is covered in screens (F) and (G): (F) lets users specify if they expect weather-related challenges during the season, and (G) provides confirmation that all required inputs have been completed. On the review screen (H), a summary of all user inputs is presented for final verification before generating the yield prediction.
Lastly, the prediction results screen (I) displays the potential palay yield, model confidence, input summary, NPK analysis, and actionable insights based on the information provided.
Appendix Figure 2. Nutrient Management Mockup
      
 (B) 				(C)
 
Appendix 6. (cont.)
Appendix Figure 3. Pest and Weather Management Mockup
             
(D)				(E) 				(F)
Appendix Figure 4. Review and Results Mockup
             
(G)				(H) 				(I)
Appendix 7. System Usability Scale (SUS) Questionnaire Form
System Usability Scale (SUS) Questionnaire
This is a standard questionnaire that measures the overall usability of a system.  Please select the answer that best expresses how you feel about each statement after using the mobile application ("Strongly Disagree" (1) to "Strongly Agree" (5)).
		1	2	3	4	5
1	I think I would like to use this tool frequently.					
2	I found the tool unnecessarily complex.					
3	I thought the tool was easy to use.					
4	I think that I would need the support of a technical person to be able to use this system.					
5	I found the various functions in this tool were well integrated.					
6	I thought there was too much inconsistency in this tool.					
7	I would imagine that most people would learn to use this tool very quickly.					
8	I found the tool very cumbersome to use.					
9	I felt very confident using the tool.					
10	I needed to learn a lot of things before I could get going with this tool.					

How likely are you to recommend this mobile application to others? (please circle your answer):
Not at all likely	0	1	2	3	4	5	6	7	8	9	10	Extremely likely

 
Appendix 8. Technology Acceptance Model (TAM) Questionnaire
Instructions:
Please indicate how much you agree or disagree with the following statements regarding your experience with the GabayPalay mobile application. 
Scale:
1 – Strongly Disagree 2 – Disagree 3 – Neutral 4 – Agree 5 – Strongly Agree

Section A: Perceived Usefulness (PU)
The following statements are about how useful the application is for your farming activities.
No.	Statement	1	2	3	4	5
PU1		Using the GabayPalay app improves my performance in managing my farm.					
PU2		The app enhances my ability to make decisions related to farming.					
PU3		The app increases my productivity as a rice farmer.					
PU4		Using the app makes it easier to plan for fertilizer and seed inputs.					
PU5		Overall, the app is useful for improving my rice yield.					

Section B: Perceived Ease of Use (PEOU)
The following statements are about how easy the application is to use.
 
Appendix 8. (cont)
No.	Statement	1	2	3	4	5
PEOU1		Learning to use the GabayPalay app was easy for me.					
PEOU2		I found the app interface to be clear and understandable.					
PEOU3		It was easy to input my farm data into the app.					
PEOU4		I can quickly become skillful at using this app.					
PEOU5		Overall, I find the app easy to use.					

[OPTIONAL] Please briefly describe your overall experience using the GabayPalay app and how it can be improved:
																																																							
 
 
Appendix Table 1. Complete raw dataset (Pre-planting) for the Phase 1 quantitative survey (n = 54), containing item-level responses used in the analyses.
ID	Land Area (in ha)	Rice Variety	Amount of Seedling used (in kg)	Planting Method	Land Preparation Method	Water Irrigation
					Manual	Tractor	Rotavator	
1	1	Hybrid	15	Transplanted	Yes	Yes	No	NIA*
2	2	Inbred	40	Transplanted	Yes	Yes	No	NIA
3	1.3	Hybrid	20	Transplanted	Yes	Yes	No	NIA
4	0.9	Inbred	40	Transplanted	No	Yes	Yes	NIA
5	0.5	Hybrid	15	Transplanted	No	Yes	No	NIA
6	0.4	Hybrid	20	Transplanted	No	Yes	No	NIA
7	0.72	Inbred	18	Transplanted	No	No	Yes	NIA
8	0.9	Inbred	40	Transplanted	No	Yes	Yes	NIA
9	1.9	Inbred	80	Transplanted	No	Yes	No	NIA
10	2	Hybrid	45	Transplanted	No	Yes	Yes	NIA
11	0.75	Hybrid	18	Transplanted	No	Yes	Yes	NIA
12	0.75	Hybrid	30	Transplanted	Yes	Yes	Yes	NIA
13	0.75	Hybrid	18	Transplanted	No	Yes	Yes	NIA
14	2	Hybrid	44	Transplanted	Yes	Yes	Yes	NIA
15	0.6	Hybrid	15	Transplanted	No	Yes	Yes	NIA
16	0.79	Hybrid	18	Transplanted	No	Yes	No	NIA
17	1	Hybrid	18	Transplanted	Yes	Yes	Yes	NIA
18	2	Inbred	80	Transplanted	Yes	Yes	Yes	NIA
19	2	Inbred	80	Transplanted	Yes	Yes	Yes	NIA

Appendix Table 1. (cont.)
20	1	Inbred	40	Transplanted	Yes	Yes	Yes	NIA
21	1	Hybrid	20	Transplanted	Yes	Yes	Yes	NIA
22	0.5	Hybrid	15	Transplanted	Yes	Yes	No	NIA
23	1.86	Hybrid	23	Transplanted	Yes	Yes	Yes	NIA
24	0.17	Hybrid	15	Transplanted	Yes	Yes	Yes	NIA
25	0.68	Hybrid	18	Transplanted	Yes	Yes	Yes	NIA
26	0.66	Hybrid	18	Transplanted	Yes	Yes	Yes	NIA
27	1	Hybrid	9	Transplanted	Yes	Yes	No	NIA
28	0.5	Hybrid	15	Transplanted	Yes	Yes	Yes	NIA
29	3	Hybrid	54	Transplanted	Yes	Yes	No	NIA
30	1	Hybrid	18	Transplanted	Yes	Yes	Yes	NIA
31	1	Hybrid	18	Transplanted	Yes	Yes	Yes	NIA
32	2	Hybrid	36	Transplanted	Yes	Yes	No	NIA
33	1	Hybrid	18	Transplanted	Yes	Yes	No	NIA
34	0.5	Hybrid	9	Transplanted	Yes	Yes	No	NIA
35	2	Hybrid	36	Transplanted	Yes	Yes	No	NIA
36	3	Hybrid	21	Transplanted	Yes	Yes	No	NIA
37	1.9	Inbred	50	Transplanted	Yes	Yes	No	NIA
38	1	Hybrid	30	Transplanted	Yes	Yes	Yes	NIA
39	0.5	Hybrid	15	Transplanted	Yes	Yes	Yes	NIA
40	1	Hybrid	30	Transplanted	Yes	Yes	Yes	NIA
41	1	Hybrid	18	Transplanted	Yes	Yes	No	NIA
42	2	Hybrid	30	Transplanted	Yes	Yes	No	NIA

Appendix Table 1. (cont.)
43	1	Hybrid	15	Transplanted	Yes	Yes	No	NIA
44	1	Hybrid	15	Transplanted	No	Yes	No	NIA
45	3	Hybrid	45	Transplanted	Yes	Yes	No	NIA
46	1	Hybrid	15	Transplanted	No	Yes	No	NIA
47	2	Hybrid	18	Transplanted	No	Yes	No	NIA
48	1.5	Hybrid	15	Transplanted	No	Yes	No	NIA
49	2.5	Hybrid	38	Transplanted	No	Yes	No	NIA
50	1.5	Hybrid	23	Transplanted	Yes	Yes	No	NIA
51	1.5	Hybrid	15	Transplanted	Yes	Yes	No	NIA
52	1	Hybrid	15	Transplanted	Yes	Yes	No	NIA
53	2	Hybrid	30	Transplanted	Yes	Yes	No	NIA
54	1	Hybrid	15	Transplanted	Yes	Yes	No	NIA
*NIA = National Irrigation Association.
 
Appendix Table 2. Complete raw dataset (Fertilizer Management) for the Phase 1 quantitative survey (n = 54), containing item-level responses used in the analyses.
ID	First Fertilizer Split	Second Fertilizer Split	Third Fertilizer Split
	F1	F2	F3	F4	F5	F1	F2	F3	F4	F5	F1	F2	F3	F4	F5
1	100	0	0	50	0	50	0	0	100	0	0	50	0	0	50
2	100	0	0	50	0	50	0	0	100	0	0	50	0	0	50
3	50	100	0	0	0	50	50	0	50	0	0	0	0	50	50
4	150	0	0	150	0	50	0	0	50	0	50	0	0	50	0
5	100	0	0	0	0	50	0	0	0	0	0	0	0	0	0
6	50	0	0	50	0	25	0	0	50	0	0	50	0	0	0
7	50	0	50	50	0	0	0	50	50	0	0	100	0	0	50
8	150	0	0	150	0	100	0	0	100	0	0	0	0	0	0
9	150	0	100	0	0	100	0	0	100	0	100	0	0	0	50
10	100	0	100	100	0	0	0	0	300	0	0	0	0	0	0
11	25	0	0	100	0	25	0	0	0	100	0	75	0	0	0
12	100	0	0	100	0	100	0	0	100	0	0	100	0	0	0
13	0	0	0	150	0	75	0	0	0	0	0	75	0	0	0
14	0	0	0	400	0	100	0	0	150	0	0	200	0	0	0
15	50	0	0	100	0	0	50	0	0	100	0	100	0	0	0
16	100	0	0	50	0	50	0	0	100	0	0	50	0	0	50
17	200	0	0	100	0	200	0	0	200	0	0	100	0	0	100
18	300	0	0	200	0	300	0	0	200	0	0	200	0	0	200
19	300	0	0	200	0	300	0	0	200	0	0	200	0	0	200
20	150	0	0	100	0	150	0	0	150	0	0	100	0	0	100
21	50	50	0	50	0	50	50	0	50	0	0	0	0	0	0

Appendix Table 2. (cont.)
22	0	0	0	100	0	50	0	50	0	0	0	0	0	0	25
23	100	0	0	100	0	0	0	150	100	0	0	150	0	0	50
24	0	0	0	50	0	50	0	0	0	0	0	20	0	0	5
25	150	0	0	0	0	50	0	0	50	0	50	0	0	50	50
26	150	0	0	0	0	100	0	0	0	0	50	0	0	50	0
27	50	0	0	0	0	25	0	0	0	0	0	0	0	0	0
28	0	0	0	100	0	50	0	50	0	0	0	0	0	0	25
29	150	0	150	150	0	150	150	0	150	0	0	0	0	0	0
30	100	0	0	200	0	300	0	0	0	0	100	0	0	0	100
31	0	0	0	200	0	100	0	100	0	0	0	0	0	0	50
32	0	0	200	400	0	200	0	0	0	0	0	0	0	0	100
33	0	0	0	200	0	100	0	100	0	0	0	0	0	0	50
34	0	0	0	100	0	50	0	50	0	0	0	0	0	0	25
35	0	0	0	400	0	200	0	200	0	0	0	0	0	0	100
36	100	0	0	100	0	100	50	0	100	0	50	50	0	0	0
37	0	0	300	0	0	0	250	0	0	0	250	0	0	0	0
38	0	0	0	200	0	100	0	100	0	0	0	0	0	0	50
39	0	0	0	200	0	100	0	100	0	0	0	0	0	0	50
40	0	0	0	200	0	100	0	100	0	0	0	0	0	0	50
41	150	0	0	0	0	100	0	0	100	0	0	0	0	0	0
42	200	0	0	200	0	200	0	0	200	0	0	200	0	200	0
43	150	0	0	0	0	50	0	0	100	0	0	0	0	0	0
44	50	0	100	0	0	100	0	50	0	0	0	0	0	50	50
45	150	0	300	0	0	300	0	150	0	0	0	0	0	150	150

Appendix Table 2. (cont.)
46	50	0	100	0	0	100	0	50	0	0	0	0	0	50	50
47	100	0	200	0	0	200	0	100	0	0	0	0	0	100	100
48	100	0	0	100	0	75	0	0	75	0	0	100	0	0	0
49	150	0	250	0	0	250	0	150	0	0	0	0	0	150	150
50	75	0	150	0	0	150	0	75	0	75	0	0	0	75	0
51	50	0	100	0	0	100	0	50	0	0	0	0	0	50	50
52	50	0	100	0	0	100	0	50	0	0	0	0	0	50	50
53	100	0	200	0	0	200	0	100	0	0	0	0	0	100	100
54	50	0	100	0	0	100	0	50	0	50	0	0	0	100	0
F1 = Urea (46-0-0), F2 = Ammonium Sulfate (21-0-0), F3 = Ammonium Phosphate (16-20-0), F4 = Complete (14-14-14), F5 = Potash (0-0-60); All values are in kilograms (kg).
 
Appendix Table 3. Complete raw dataset (Pest Management) for the Phase 1 quantitative survey (n = 54), containing item-level responses used in the analyses.
ID	Pest Encountered	Amount of Pesticide used
	Stem Borer	Rats	Kuhol	Cutworms	Rice Blast	Insecticide (in L)	Herbicide (in L)	Rat Poison (in grams)	Molluscicide (in sachets)
1	Yes	No	Yes	No	No	1	0	0	10
2	Yes	No	Yes	No	No	1	0	0	10
3	Yes	Yes	Yes	Yes	No	1	1	0	10
4	No	No	Yes	No	No	0	0	0	10
5	No	No	No	No	No	0	0	0	0
6	No	No	Yes	No	No	0	0	0	10
7	Yes	No	Yes	No	No	0	0	0	10
8	Yes	No	Yes	No	No	1	0	0	10
9	Yes	No	Yes	No	No	1	0	0	10
10	Yes	Yes	Yes	No	No	2	2	20	20
11	No	Yes	Yes	No	No	0	1	0	20
12	No	No	Yes	No	No	0	0	0	10
13	No	No	Yes	No	No	0	0	0	10
14	Yes	No	Yes	No	No	0	0	0	10
15	Yes	Yes	Yes	No	Yes	0.5	0.5	500	0
16	Yes	Yes	Yes	No	Yes	0.5	0.5	0	0
17	Yes	No	No	No	No	0	0.5	0	0
18	Yes	No	No	No	Yes	1	1	0	0
19	Yes	No	No	No	Yes	1	1	0	0
20	Yes	No	No	No	Yes	0	0.5	0	0

Appendix Table 3. (cont.)
21	Yes	No	No	No	Yes	1	1	0	0
22	Yes	No	No	No	No	0	1	0	0
23	Yes	No	No	No	Yes	0	1	0	0
24	Yes	No	No	No	No	0	1	0	0
25	Yes	No	No	No	No	0	0	0	0
26	Yes	No	No	No	No	0	0	0	0
27	Yes	No	No	No	No	1	0	0	0
28	Yes	No	No	No	No	0	0	0	0
29	Yes	No	No	No	Yes	0	3	0	0
30	Yes	No	No	No	No	0.5	0.5	0	0
31	Yes	No	No	No	Yes	0	2	0	0
32	Yes	No	No	No	Yes	0	0	0	0
33	Yes	No	No	No	Yes	0	1	0	0
34	Yes	No	No	No	Yes	0	0	0	0
35	Yes	No	No	No	Yes	0	0	0	0
36	Yes	No	No	No	Yes	0	0	0	0
37	Yes	No	No	No	Yes	0	0	0	0
38	Yes	No	No	No	Yes	0	2	0	0
39	Yes	No	No	No	No	0	2	0	0
40	Yes	No	No	No	No	0	2	0	0
41	Yes	No	No	No	Yes	0	1	0	0
42	Yes	No	No	No	Yes	1	3	0	0
43	Yes	No	No	No	Yes	0	0	0	0
44	Yes	No	No	No	No	0	0	0	0

Appendix Table 3. (cont.)
45	Yes	No	No	No	Yes	0	0	0	0
46	Yes	No	No	No	No	0	0	0	0
47	Yes	No	No	No	No	0	0	0	0
48	Yes	No	No	No	No	0	0	0	0
49	Yes	No	No	No	Yes	0	0	0	0
50	Yes	No	No	No	No	0	0	0	0
51	Yes	No	No	No	No	0	0	0	0
52	Yes	No	No	No	No	0	0	0	0
53	Yes	No	No	No	No	0	0	0	0
54	No	No	No	No	No	0	0	0	0
 
Appendix Table 4. Complete raw dataset (Yield (in kg)) for the Phase 1 quantitative survey (n = 54), containing item-level responses used in the analyses.
ID	Palay Yield (in kg)
1	6000
2	6000
3	10010
4	3250
5	2700
6	2924
7	4800
8	5700
9	11880
10	12870
11	4838
12	5400
13	4340
14	11640
15	4725
16	5580
17	5400
18	6615
19	13020
20	6710
21	6930
22	3840
23	11590
24	1220
25	4410
26	4030
27	2100
28	3720
29	20790
30	7930
31	7440
32	15750
33	7040
34	3660

Appendix Table 4. (cont.)
35	15600
36	18300
37	11940
38	6400
39	6820
40	7150
41	3150
42	15376
43	5400
44	6174
45	16920
46	2790
47	10858
48	9600
49	15232
50	9450
51	6100
52	5917
53	12078
54	6060
 
Appendix Table X. Descriptive statistics of palay yield by variety type and weather challenge status (n=54).**

| Category | Variable | n | Median (kg/ha) | Mean (kg/ha) | Std Dev (kg) | CV (%) | Range (kg) |
|----------|----------|---|----------------|--------------|--------------|--------|------------|
| **Overall** | All farms | 54 | 6,287 | 7,892 | 4,582 | 58.1 | 1,220–20,790 |
| **By Variety** | Hybrid (X2=1) | 45 | 6,174 | 7,917 | 4,795 | 60.6 | 1,220–20,790 |
| | Inbred (X2=0) | 9 | 6,615 | 7,768 | 3,553 | 45.7 | 3,250–13,020 |
| **By Weather** | Challenges present (X27=1) | 43 | 6,710 | 8,275 | 4,721 | 57.0 | 1,220–20,790 |
| | No challenges (X27=0) | 11 | 4,838 | 6,395 | 3,818 | 59.7 | 2,440–13,020 |

*Note:* CV = Coefficient of Variation, calculated as (Standard Deviation / Mean) × 100. Descriptive statistics computed from processed dataset (n=54 farms) using Python pandas library. All yield values reported at farm level; kg/ha conversions assumed equal land area weighting where applicable.
